{"ast":null,"code":"var _jsxFileName = \"/home/actserv/Documents/brooks_insurance_agency_software/brooks-insurance-front-end/src/components/messages/sendMessages.js\";\nimport React, { useState, useContext, useEffect, useCallback } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Grid, Container, Header, Icon, Form, Button, Divider, Tab, Message, Menu, Segment, Radio } from 'semantic-ui-react';\nimport Messages from './listPreviousMessages';\nimport { AuthContext } from '../../context/auth';\nimport { useMutation, useQuery } from '@apollo/react-hooks';\nimport 'react-chat-elements/dist/main.css';\nimport { SEND_WHATSAPP_MESSAGE, GET_WHATSAPP_MESSAGES } from './queries';\nimport * as yup from \"yup\";\nimport { WhatsAppMessageContext } from '../../context/whatsappMessages';\nexport default function SendWhatsappMessages(props) {\n  let history = useHistory();\n  const [errors, setErrors] = useState({\n    errorPaths: [],\n    errors: []\n  });\n  const [responseErrors, setResponseErrors] = useState([]);\n  const context = useContext(WhatsAppMessageContext);\n  const authContext = useContext(AuthContext);\n  const [messages, setMessages] = useState();\n  const [visible, setVisible] = useState(false);\n  const [search, setSearch] = useState({\n    search: \"\"\n  });\n  const [values, setValues] = useState({\n    messageOption: \"S\",\n    whatsappResponse: [],\n    whatsappMessageId: []\n  });\n  const [pagination, setPagination] = useState({\n    whatsappPhoneNumber: \"+254700701209\",\n    page: 1,\n    limit: 10\n  });\n  let schema = yup.object().shape({\n    whatsappResponse: yup.string(),\n    whatsappMessageId: yup.string()\n  });\n  const {\n    data: messageData\n  } = useQuery(GET_WHATSAPP_MESSAGES, {\n    variables: pagination\n  });\n  useEffect(() => {\n    if (messageData) {\n      setMessages(messageData.whatsappMessages.items);\n    }\n\n    console.log(messageData);\n  }, [messageData, messages]);\n  const onChange = useCallback((event, {\n    name,\n    value\n  }) => {\n    setValues({ ...values,\n      [name]: value,\n      updated: true\n    });\n  }, [values]);\n  const setMessageOps = useCallback(() => {\n    const users = [...values.individualClients, ...values.corporateClients, ...values.contactPersons];\n\n    if (users.length < 2) {\n      setValues({ ...values,\n        messageOption: \"S\",\n        messageOptUpdated: false\n      });\n    } else {\n      setValues({ ...values,\n        messageOption: \"M\",\n        messageOptUpdated: false\n      });\n    }\n  }, [values]);\n  const validate = useCallback(values => {\n    schema.validate(values, {\n      abortEarly: false\n    }).then(valid => setErrors({\n      errorPaths: [],\n      errors: []\n    })) //called if the entire form is valid\n    .catch(err => {\n      setErrors({\n        errors: err.errors,\n        errorPaths: err.inner.map(i => i.path)\n      });\n    });\n  }, [schema]);\n  const [sendMessage, {\n    loading\n  }] = useCallback(useMutation(SEND_WHATSAPP_MESSAGE, {\n    update(_, result) {\n      context.sendMessage(result.data.sendMessage.message);\n      history.push({\n        pathname: `/staff/dashboard/crm/whatsAppmessage/${result.data.sendWhatsappMessage.whatsappMessage.whatsappPhoneNumber}`\n      });\n    },\n\n    onError(err) {\n      console.log(err.graphQLErrors && err.graphQLErrors[0] ? err.graphQLErrors[0].message : err.networkError && err.networkError.result ? err.networkError.result.errors : err);\n\n      try {\n        if (err.graphQLErrors) {\n          setResponseErrors(err.graphQLErrors[0].message);\n        }\n\n        if (err.networkError !== null && err.networkError !== 'undefined') {\n          setResponseErrors(err.networkError.result.errors[0]);\n        } else if (err.graphQLErrors !== null && err.networkError !== 'undefined') {\n          setResponseErrors(err.graphQLErrors.result.errors[0]);\n        }\n      } catch (e) {\n        setVisible(true);\n      }\n    },\n\n    variables: values\n  }));\n\n  const handleOnMessageChange = (e, {\n    value\n  }) => {\n    e.preventDefault();\n    setValues({ ...values,\n      previousResponses: value,\n      updated: true\n    });\n  };\n\n  const panes = [{\n    menuItem: /*#__PURE__*/React.createElement(Menu.Item, {\n      key: \"clients\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 17\n      }\n    }, \"Whatsapp Notify\"),\n    render: () => {\n      return /*#__PURE__*/React.createElement(Tab.Pane, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(Form, {\n        noValidate: true,\n        className: loading ? \"loading\" : '',\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(Form.Group, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(Message, {\n        visible: !!errors.errors.length || visible,\n        warning: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(Message.Header, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 37\n        }\n      }, \"Please correct the following issues:\"), !!responseErrors.length && /*#__PURE__*/React.createElement(Message, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 65\n        }\n      }, responseErrors), /*#__PURE__*/React.createElement(Message.List, {\n        items: errors.errors,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 38\n        }\n      }))), /*#__PURE__*/React.createElement(Divider, {\n        horizontal: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 29\n        }\n      }, \"Send notification options\"), /*#__PURE__*/React.createElement(Form.Group, {\n        widths: \"equal\",\n        as: Segment,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(Form.Field, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(Radio, {\n        label: \"Send to ALL\",\n        name: \"radioGroup\",\n        value: \"all\",\n        toggle: true,\n        checked: values.all,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 37\n        }\n      }))), /*#__PURE__*/React.createElement(Form.Group, {\n        widths: \"equal\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(Form.Field, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 37\n        }\n      }, \"Choose People to Send (s)\"), messageData && /*#__PURE__*/React.createElement(Messages, {\n        multiple: true,\n        recipients: messageData,\n        handleOnMessageChange: handleOnMessageChange,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 53\n        }\n      }))), /*#__PURE__*/React.createElement(Form.Group, {\n        widths: \"equal\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(Form.Field, {\n        error: errors.errorPaths.includes('sms'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 37\n        }\n      }, \"Whatsapp SMS\"), /*#__PURE__*/React.createElement(Form.Input, {\n        fluid: true,\n        placeholder: \"Send whatsapp Text\",\n        name: \"sms\",\n        onChange: onChange,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 37\n        }\n      }))), /*#__PURE__*/React.createElement(Button, {\n        type: \"submit\",\n        positive: true,\n        onClick: () => {\n          sendMessage();\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 29\n        }\n      }, \"Send Message\")));\n    }\n  }];\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    padded: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Grid.Column, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Header, {\n    as: \"h2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Icon, {\n    name: \"settings\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(Header.Content, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"a\", {\n    href: \"/staff/dashboard/overview\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 33\n    }\n  }, \"Overview\"), \" \", '>', \" \", /*#__PURE__*/React.createElement(\"a\", {\n    href: \"/staff/dashboard/overview/crm\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 88\n    }\n  }, \" CRM \"), '>', \" \", /*#__PURE__*/React.createElement(\"a\", {\n    href: \"/staff/dashboard/crm/messages\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 143\n    }\n  }, \"Messages\"), \" \", '>', \" Send Messages\", /*#__PURE__*/React.createElement(Header.Subheader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 33\n    }\n  }, \"Hello \", authContext.user.username, \", Fill in this form to send messages to prospective clients\")))))), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    padded: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Grid.Column, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Tab, {\n    panes: panes,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 21\n    }\n  }))));\n}","map":{"version":3,"sources":["/home/actserv/Documents/brooks_insurance_agency_software/brooks-insurance-front-end/src/components/messages/sendMessages.js"],"names":["React","useState","useContext","useEffect","useCallback","useHistory","Grid","Container","Header","Icon","Form","Button","Divider","Tab","Message","Menu","Segment","Radio","Messages","AuthContext","useMutation","useQuery","SEND_WHATSAPP_MESSAGE","GET_WHATSAPP_MESSAGES","yup","WhatsAppMessageContext","SendWhatsappMessages","props","history","errors","setErrors","errorPaths","responseErrors","setResponseErrors","context","authContext","messages","setMessages","visible","setVisible","search","setSearch","values","setValues","messageOption","whatsappResponse","whatsappMessageId","pagination","setPagination","whatsappPhoneNumber","page","limit","schema","object","shape","string","data","messageData","variables","whatsappMessages","items","console","log","onChange","event","name","value","updated","setMessageOps","users","individualClients","corporateClients","contactPersons","length","messageOptUpdated","validate","abortEarly","then","valid","catch","err","inner","map","i","path","sendMessage","loading","update","_","result","message","push","pathname","sendWhatsappMessage","whatsappMessage","onError","graphQLErrors","networkError","e","handleOnMessageChange","preventDefault","previousResponses","panes","menuItem","render","all","includes","user","username"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect, useCallback } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport {\n    Grid,\n    Container,\n    Header,\n    Icon,\n    Form,\n    Button,\n    Divider,\n    Tab,\n    Message,\n    Menu,\n    Segment,\n    Radio,\n} from 'semantic-ui-react';\nimport Messages from './listPreviousMessages';\n\nimport { AuthContext } from '../../context/auth';\n\nimport { useMutation, useQuery} from '@apollo/react-hooks';\n\nimport 'react-chat-elements/dist/main.css';\n\n\nimport {\n   SEND_WHATSAPP_MESSAGE,GET_WHATSAPP_MESSAGES\n} from './queries'\nimport * as yup from \"yup\";\nimport { WhatsAppMessageContext } from '../../context/whatsappMessages';\n\nexport default function SendWhatsappMessages(props) {\n    let history = useHistory();\n    const [errors, setErrors] = useState({\n        errorPaths: [],\n        errors: []\n    });\n    const [responseErrors, setResponseErrors] = useState([]);\n    const context = useContext(WhatsAppMessageContext);\n    const authContext = useContext(AuthContext);\n    const [messages, setMessages] = useState();\n    \n    const [visible, setVisible] = useState(false);\n\n    const [search, setSearch] = useState({ search: \"\" });\n    const [values, setValues] = useState({\n        messageOption: \"S\",\n        whatsappResponse: [],\n        whatsappMessageId: [],\n\n       \n    });\n    const [pagination,setPagination]=useState({\n        whatsappPhoneNumber:\"+254700701209\",\n        page:1,\n        limit:10\n    })\n\n    let schema = yup.object().shape({\n        whatsappResponse: yup.string(),\n        whatsappMessageId: yup.string(),\n\n    });\n\n\n    const { data: messageData } = useQuery(GET_WHATSAPP_MESSAGES, {\n        variables: pagination\n    });\n    useEffect(() => {\n        if (messageData) {\n            setMessages(messageData.whatsappMessages.items);\n        }\n        console.log(messageData)\n    }, [messageData,messages]);\n\n\n    const onChange = useCallback((event, { name, value }) => {\n        setValues({ ...values, [name]: value, updated: true });\n    }, [values])\n    const setMessageOps = useCallback(() => {\n        const users = [...values.individualClients, ...values.corporateClients, ...values.contactPersons]\n        if (users.length < 2) {\n            setValues({ ...values, messageOption: \"S\", messageOptUpdated: false })\n        } else {\n            setValues({ ...values, messageOption: \"M\", messageOptUpdated: false })\n        }\n    }, [values])\n    \n    \n \n\n\n    const validate = useCallback((values) => {\n        schema.validate(values, { abortEarly: false })\n            .then(valid => setErrors({ errorPaths: [], errors: [] })) //called if the entire form is valid\n            .catch(err => {\n                setErrors({ errors: err.errors, errorPaths: err.inner.map(i => i.path) })\n            })\n    }, [schema])\n\n    const [sendMessage, { loading }] = useCallback(useMutation(SEND_WHATSAPP_MESSAGE, {\n        update(_, result) {\n            context.sendMessage(result.data.sendMessage.message)\n            history.push({\n                pathname: `/staff/dashboard/crm/whatsAppmessage/${result.data.sendWhatsappMessage.whatsappMessage.whatsappPhoneNumber}`\n            })\n        },\n        onError(err) {\n            console.log(err.graphQLErrors && err.graphQLErrors[0] ? err.graphQLErrors[0].message : err.networkError && err.networkError.result ? err.networkError.result.errors : err)\n            try {\n                if (err.graphQLErrors) {\n                    setResponseErrors(err.graphQLErrors[0].message);\n                }\n\n                if (err.networkError !== null && err.networkError !== 'undefined') {\n\n                    setResponseErrors(err.networkError.result.errors[0]);\n\n                } else if (err.graphQLErrors !== null && err.networkError !== 'undefined') {\n\n                    setResponseErrors(err.graphQLErrors.result.errors[0]);\n\n                }\n            } catch (e) {\n                setVisible(true);\n            }\n\n        },\n        variables: values,\n    }));\n\n    \n    const handleOnMessageChange = (e, { value }) => {\n        e.preventDefault()\n        setValues({ ...values, previousResponses: value, updated: true });\n    }\n\n\n    \n\n    const panes = [\n        {\n            menuItem: (\n                <Menu.Item key='clients'>\n                    Whatsapp Notify\n                </Menu.Item>\n            ),\n            render: () => {\n                return (\n                    <Tab.Pane>\n                        <Form noValidate className={loading ? \"loading\" : ''}>\n                            <Form.Group>\n                                <Message visible={!!errors.errors.length || visible} warning>\n                                    <Message.Header>Please correct the following issues:</Message.Header>\n                                    {!!responseErrors.length && <Message>{responseErrors}</Message>}\n                                    {<Message.List items={errors.errors} />}\n                                </Message>\n                            </Form.Group>\n                            <Divider horizontal>Send notification options</Divider>\n                            <Form.Group widths='equal' as={Segment}>\n                                <Form.Field>\n                                    <Radio\n                                        label='Send to ALL'\n                                        name='radioGroup'\n                                        value='all'\n                                        toggle\n                                        checked={values.all}\n                                    />\n                                </Form.Field>\n\n                            </Form.Group>\n                            <Form.Group widths='equal'>\n                                <Form.Field>\n                                    <label>Choose People to Send (s)</label>\n                                    {messageData && <Messages\n                                        multiple={true}\n                                        recipients={messageData}\n                                        handleOnMessageChange={handleOnMessageChange}\n                                    />}\n                                </Form.Field>\n                            </Form.Group>\n                            \n                            <Form.Group widths='equal'>\n                                <Form.Field error={errors.errorPaths.includes('sms')}>\n                                    <label>Whatsapp SMS</label>\n                                    <Form.Input fluid placeholder='Send whatsapp Text'\n                                        name='sms'\n                                        onChange={onChange}\n\n                                    />\n                                </Form.Field>\n\n                            </Form.Group>\n                            <Button type='submit' positive onClick={() => { sendMessage(); }}>\n                                Send Message\n                        </Button>\n                        </Form>\n\n                    </Tab.Pane>\n                )\n            },\n        },\n\n\n    ]\n\n    return (\n        <Container>\n            <Grid container padded>\n                <Grid.Column>\n                    <div className=\"content-wrapper\">\n                        <Header as='h2'>\n                            <Icon name='settings' />\n                            <Header.Content>\n                                <a href=\"/staff/dashboard/overview\">Overview</a> {'>'} <a href=\"/staff/dashboard/overview/crm\"> CRM </a>{'>'} <a href=\"/staff/dashboard/crm/messages\">Messages</a> {'>'} Send Messages\n                                <Header.Subheader>\n                                    Hello {authContext.user.username}, Fill in this form to send messages to prospective clients\n                                </Header.Subheader>\n                            </Header.Content>\n                        </Header>\n                    </div>\n                </Grid.Column>\n            </Grid>\n\n            <Grid container padded>\n                <Grid.Column>\n                    <Tab panes={panes} />\n\n\n\n                </Grid.Column>\n            </Grid>\n\n            \n\n        </Container >\n    )\n}\n"]},"metadata":{},"sourceType":"module"}