{"ast":null,"code":"var _jsxFileName = \"/home/actserv/Documents/brooks_insurance_agency_software/brooks-insurance-front-end/src/components/messages/messageDetails.js\";\nimport React, { useState, useContext, useEffect, useCallback } from 'react';\nimport { Link } from 'react-router-dom';\nimport { Grid, Container, Divider, Header, Icon, Menu, Form, Tab, GridColumn } from 'semantic-ui-react';\nimport moment from 'moment';\nimport 'react-chat-elements/dist/main.css';\nimport { MessageList, Input, Button, MessageBox } from 'react-chat-elements';\nimport { useMutation, useQuery } from '@apollo/react-hooks';\nimport { GET_WHATSAPP_MESSAGES, SEND_WHATSAPP_MESSAGE, FETCH_AGENTS_QUERY, ASSIGN_SALES_AGENT } from './queries';\nimport { AuthContext } from '../../context/auth';\nimport { WhatsAppMessageContext } from '../../context/whatsappMessages';\nimport NestedMessages from './nestedMessages';\nimport Agents from './listAgents';\nexport default function WhatsAppMessage({\n  props\n}) {\n  const authContext = useContext(AuthContext);\n  const [messages, setMessages] = useState([]);\n  const [errors, setErrors] = useState({});\n  const context = useContext(WhatsAppMessageContext);\n  const whatsappPhoneNumber = props.computedMatch.params.whatsappPhoneNumber;\n  let recipientsColumns = 1;\n  const [agents, setAgents] = useState({});\n  const [search, setSearch] = useState();\n  const [fetched, setFetched] = useState(false);\n  const [pagination, setPagination] = useState({\n    limit: 10,\n    page: 1,\n    whatsappPhoneNumber: whatsappPhoneNumber,\n    search: \"\"\n  });\n  const [agentPagination, setAgentPagination] = useState({\n    limit: 10,\n    page: 1,\n    search: \"\"\n  });\n  const [values, setValues] = useState({\n    whatsappResponse: \"\",\n    whatsappMessageId: \"\"\n  });\n  const [agentValues, setAgentValues] = useState({\n    whatsappPhoneNumber: \"\",\n    salesAgentAssignedId: \"\"\n  });\n  const {\n    data\n  } = useQuery(GET_WHATSAPP_MESSAGES, {\n    variables: pagination\n  });\n  useEffect(() => {\n    if (data) {\n      setMessages(data.whatsappMessages);\n    }\n  }, [data, context, fetched]);\n  const {\n    data: agentsData\n  } = useQuery(FETCH_AGENTS_QUERY, {\n    variables: agentPagination\n  });\n  useEffect(() => {\n    if (agentsData) {\n      setAgents(agentsData.users);\n    }\n  }, [agentsData]);\n  const [sendMessage, {\n    loading\n  }] = useCallback(useMutation(SEND_WHATSAPP_MESSAGE, {\n    update(_, result) {\n      console.log(result.data);\n      window.location.reload();\n    },\n\n    onError(err) {\n      try {\n        console.log(err.graphQLErrors && err.graphQLErrors[0] ? err.graphQLErrors[0].message : err.networkError && err.networkError.result ? err.networkError.result.errors : err);\n      } catch (e) {\n        console.log(e);\n      }\n    },\n\n    variables: values\n  }));\n  const [assignSalesAgent] = useCallback(useMutation(ASSIGN_SALES_AGENT, {\n    update(_, result) {\n      console.log(result.data);\n      window.location.reload();\n    },\n\n    onError(err) {\n      try {\n        console.log(err.graphQLErrors && err.graphQLErrors[0] ? err.graphQLErrors[0].message : err.networkError && err.networkError.result ? err.networkError.result.errors : err);\n      } catch (e) {\n        console.log(e);\n      }\n    },\n\n    variables: values\n  }));\n\n  const handleOnAgentSearch = e => {\n    setSearch({\n      search: e.target.value\n    });\n  };\n\n  const handleOnAgentChange = (e, {\n    value\n  }) => {\n    e.preventDefault();\n    setValues({ ...values,\n      whatsappPhoneNumber: whatsappPhoneNumber,\n      salesAgentAssignedId: value,\n      updated: true\n    }); // validate()\n  };\n\n  const handleChange = e => {\n    e.preventDefault();\n    const message = messages.items.slice(-1)[0];\n    const messageId = !!message.previousResponses.length ? message.previousResponses[0].id : message.id;\n    setValues({ ...values,\n      whatsappResponse: e.target.value,\n      whatsappMessageId: messageId\n    });\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    sendMessage();\n  };\n\n  const handleSalesAgentAssignment = e => {\n    e.preventDefault();\n    assignSalesAgent();\n  };\n\n  function messageDetails() {\n    return /*#__PURE__*/React.createElement(Container, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Grid, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Grid.Column, {\n      textAlign: \"right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Form, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Form.Group, {\n      widths: \"equal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Form.Field, {\n      required: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 33\n      }\n    }, \"Client\"), agents && agents.items && /*#__PURE__*/React.createElement(Agents, {\n      agents: agents.items,\n      handleOnAgentSearch: handleOnAgentSearch,\n      handleOnAgentChange: handleOnAgentChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 60\n      }\n    })))), /*#__PURE__*/React.createElement(Button, {\n      onClick: handleSalesAgentAssignment,\n      color: \"white\",\n      backgroundColor: \"blue\",\n      text: \"Assign Sales Agent\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 21\n      }\n    }))), messages.items ? messages.items.map((message, key) => /*#__PURE__*/React.createElement(NestedMessages, {\n      key: key,\n      message: message,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 21\n      }\n    })) : \"No messages\", /*#__PURE__*/React.createElement(Divider, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(Input, {\n      placeholder: \"Type here...\",\n      onChange: handleChange,\n      multiline: true,\n      rightButtons: /*#__PURE__*/React.createElement(Button, {\n        onClick: handleSubmit,\n        color: \"white\",\n        backgroundColor: \"black\",\n        text: \"Send\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 25\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 17\n      }\n    }));\n  }\n\n  const panes = [{\n    menuItem: /*#__PURE__*/React.createElement(Menu.Item, {\n      key: \"Message\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 17\n      }\n    }, \"Message Details\"),\n    render: () => {\n      return /*#__PURE__*/React.createElement(Tab.Pane, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 21\n        }\n      }, messageDetails());\n    }\n  }];\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    columns: 1,\n    padded: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Grid.Column, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Header, {\n    as: \"h2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Icon, {\n    name: \"file\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(Header.Content, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"a\", {\n    href: \"/staff/dashboard/overview\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 33\n    }\n  }, \"Overview\"), \" \", '>', \" \", /*#__PURE__*/React.createElement(\"a\", {\n    href: \"/staff/dashboard/crm\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 88\n    }\n  }, \"CRM\"), \" \", '>', \" \", /*#__PURE__*/React.createElement(\"a\", {\n    href: \"/staff/dashboard/crm/messages\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 133\n    }\n  }, \"Messages\"), \" \", '>', \" Message Details\", /*#__PURE__*/React.createElement(Header.Subheader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 33\n    }\n  }, \"Hey there \", authContext.user.username, \", find a list of motor policies under General Insurance below\")))))), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    padded: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Grid.Column, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Tab, {\n    panes: panes,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 21\n    }\n  }))));\n}","map":{"version":3,"sources":["/home/actserv/Documents/brooks_insurance_agency_software/brooks-insurance-front-end/src/components/messages/messageDetails.js"],"names":["React","useState","useContext","useEffect","useCallback","Link","Grid","Container","Divider","Header","Icon","Menu","Form","Tab","GridColumn","moment","MessageList","Input","Button","MessageBox","useMutation","useQuery","GET_WHATSAPP_MESSAGES","SEND_WHATSAPP_MESSAGE","FETCH_AGENTS_QUERY","ASSIGN_SALES_AGENT","AuthContext","WhatsAppMessageContext","NestedMessages","Agents","WhatsAppMessage","props","authContext","messages","setMessages","errors","setErrors","context","whatsappPhoneNumber","computedMatch","params","recipientsColumns","agents","setAgents","search","setSearch","fetched","setFetched","pagination","setPagination","limit","page","agentPagination","setAgentPagination","values","setValues","whatsappResponse","whatsappMessageId","agentValues","setAgentValues","salesAgentAssignedId","data","variables","whatsappMessages","agentsData","users","sendMessage","loading","update","_","result","console","log","window","location","reload","onError","err","graphQLErrors","message","networkError","e","assignSalesAgent","handleOnAgentSearch","target","value","handleOnAgentChange","preventDefault","updated","handleChange","items","slice","messageId","previousResponses","length","id","handleSubmit","handleSalesAgentAssignment","messageDetails","map","key","panes","menuItem","render","user","username"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect, useCallback } from 'react';\nimport { Link } from 'react-router-dom';\nimport {\n    Grid,\n    Container,\n    Divider,\n    Header,\n    Icon,\n    Menu,\n    Form,\n    Tab,\n    GridColumn,\n} from 'semantic-ui-react';\nimport moment from 'moment';\nimport 'react-chat-elements/dist/main.css';\nimport { MessageList, Input, Button, MessageBox } from 'react-chat-elements';\nimport { useMutation, useQuery } from '@apollo/react-hooks';\nimport { GET_WHATSAPP_MESSAGES, SEND_WHATSAPP_MESSAGE, FETCH_AGENTS_QUERY,ASSIGN_SALES_AGENT } from './queries'\nimport { AuthContext } from '../../context/auth';\nimport { WhatsAppMessageContext } from '../../context/whatsappMessages';\nimport NestedMessages from './nestedMessages';\nimport Agents from './listAgents';\n\n\nexport default function WhatsAppMessage({ props }) {\n    const authContext = useContext(AuthContext);\n    const [messages, setMessages] = useState([]);\n    const [errors, setErrors] = useState({});\n    const context = useContext(WhatsAppMessageContext);\n    const whatsappPhoneNumber = props.computedMatch.params.whatsappPhoneNumber\n    let recipientsColumns = 1\n    const [agents, setAgents] = useState({});\n    const [search, setSearch]=useState();\n\n    const [fetched, setFetched] = useState(false);\n    const [pagination, setPagination] = useState({\n        limit: 10,\n        page: 1,\n        whatsappPhoneNumber: whatsappPhoneNumber,\n        search: \"\"\n    });\n    const [agentPagination,setAgentPagination]=useState({\n        limit:10,\n        page:1,\n        search:\"\"\n    });\n    const [values, setValues] = useState({\n        whatsappResponse: \"\",\n        whatsappMessageId: \"\"\n    });\n\n    const [agentValues,setAgentValues]=useState({\n        whatsappPhoneNumber:\"\",\n        salesAgentAssignedId:\"\",\n    });\n\n    const { data } = useQuery(GET_WHATSAPP_MESSAGES, { variables: pagination });\n    useEffect(() => {\n        if (data) {\n            setMessages(data.whatsappMessages);\n        }\n    }, [data, context, fetched,]);\n    \n    const {data: agentsData } = useQuery(FETCH_AGENTS_QUERY,\n        { variables: agentPagination });\n    useEffect(() => {\n        if (agentsData) {\n            setAgents(agentsData.users)\n        }\n    }, [agentsData])\n\n    \n\n    const [sendMessage, { loading }] = useCallback(useMutation(SEND_WHATSAPP_MESSAGE,\n        {\n            update(_, result) {\n                console.log(result.data);\n                window.location.reload();   \n\n            },  \n            onError(err) {\n                try {\n                    console.log(err.graphQLErrors && err.graphQLErrors[0] ? err.graphQLErrors[0].message : err.networkError && err.networkError.result ? err.networkError.result.errors : err)\n                } catch (e) {\n                    console.log(e)\n                }\n\n            },\n            variables: values,\n        }));\n\n    const [assignSalesAgent] = useCallback(useMutation(ASSIGN_SALES_AGENT,\n        {\n            update(_, result) {\n                console.log(result.data);\n                window.location.reload();   \n\n            },  \n            onError(err) {\n                try {\n                    console.log(err.graphQLErrors && err.graphQLErrors[0] ? err.graphQLErrors[0].message : err.networkError && err.networkError.result ? err.networkError.result.errors : err)\n                } catch (e) {\n                    console.log(e)\n                }\n\n            },\n            variables: values,\n        }));\n    \n    \n    const handleOnAgentSearch = (e) => {\n        setSearch({ search: e.target.value });\n    }\n    const handleOnAgentChange = (e, { value }) => {\n        e.preventDefault()\n        setValues({ ...values,whatsappPhoneNumber:whatsappPhoneNumber, salesAgentAssignedId: value, updated: true });\n        // validate()\n    }    \n\n\n\n    const handleChange = (e) => {\n        e.preventDefault()\n        const message = messages.items.slice(-1)[0]\n        const messageId = !!message.previousResponses.length ? message.previousResponses[0].id : message.id\n        setValues({ ...values, whatsappResponse: e.target.value, whatsappMessageId: messageId })\n    }\n\n    const handleSubmit = (e) => {\n        e.preventDefault()\n        sendMessage()\n    }\n\n\n    const handleSalesAgentAssignment = (e) => {\n        e.preventDefault()\n        assignSalesAgent()\n        \n    }\n    function messageDetails() {\n        return (\n            <Container>\n                <Grid>\n                <Grid.Column textAlign=\"right\">\n                    <Form>\n                    <Form.Group widths='equal'>\n                            <Form.Field required>\n                                <label>Client</label>\n                                {agents && agents.items && <Agents\n                                    agents={agents.items}\n                                    handleOnAgentSearch={handleOnAgentSearch}\n                                    handleOnAgentChange={handleOnAgentChange}\n                                />}\n                            </Form.Field>\n                    </Form.Group>\n                    </Form>\n                    <Button\n                        onClick={handleSalesAgentAssignment}\n                        color='white'\n                        backgroundColor='blue'\n                        text='Assign Sales Agent' />\n                </Grid.Column>\n            </Grid>\n            \n                { messages.items ? messages.items.map((message, key) => (\n\n                    <NestedMessages key={key} message={message} />\n                )) : \"No messages\"}\n                <Divider></Divider>\n                <Input\n                    placeholder=\"Type here...\"\n                    onChange={handleChange}\n                    multiline={true}\n                    rightButtons={\n                        <Button\n                            onClick={handleSubmit}\n                            color='white'\n                            backgroundColor='black'\n                            text='Send' />\n                    } />\n            </Container>\n        )\n    }\n\n\n    const panes = [\n        {\n            menuItem: (\n                <Menu.Item key='Message'>\n                    Message Details\n                </Menu.Item>\n            ),\n            render: () => {\n                return (\n                    <Tab.Pane>\n                        {messageDetails()}\n\n                    </Tab.Pane>\n                )\n            },\n        }\n    ]\n\n    return (\n        <Container>\n            <Grid container columns={1} padded>\n                <Grid.Column>\n                    <div className=\"content-wrapper\">\n                        <Header as='h2'>\n                            <Icon name='file' />\n                            <Header.Content>\n                                <a href=\"/staff/dashboard/overview\">Overview</a> {'>'} <a href=\"/staff/dashboard/crm\">CRM</a> {'>'} <a href=\"/staff/dashboard/crm/messages\">Messages</a> {'>'} Message Details\n                                <Header.Subheader>\n                                    Hey there {authContext.user.username}, find a list of motor policies under General Insurance below\n                                </Header.Subheader>\n                            </Header.Content>\n                        </Header>\n                    </div>\n                </Grid.Column>\n            </Grid>\n\n\n\n            <Grid container padded>\n                <Grid.Column>\n                    <Tab panes={panes} />\n                </Grid.Column>\n            </Grid>\n\n        </Container>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}